### Kafka
1. Kafka is run as a cluster on one or more servers.
1. The Kafka cluster stores streams of records in categories called topics.
1. Each record consists of a key, value, and a timesstamp.

- Each topic consists of multiple partitions.
  - allow the log to scale horizontally
  - act as the unit of parallelism.
- Sequencial id number in each partition is called **offset** which uniquely identifies each record within the partition.
- The Kafka cluster durably persists all published records.

#### Distribution
- Each partition is replicated across a configurable number of servers for fault tolerance.
- Each partiion has one server acts as the "leader" and zero or more as "followers".

#### Consumer
- Consumer label themselves with a *consumer group* name.
  - Each record published to a topic is delivered to one consumer instance within each subscribing consumer group.
  - Consumer instances could be in separate processes or on separate machines.

#### Kafka as  Messaging system
Mainly two Models
1. queuing
1. publish-subscribe
Kafka bears both of these two characteristics

#### Kafka as a storage system
Every record is written to disk and duplicated for fault-tolerance.

#### Kafka for stream processing
- Stream processor


#### Zookeeper
- ZooKeeper 是一个分布式的，开放源码的分布式应用程序协调服务，是Google的Chubby一个开源的实现，是Hadoop和Hbase的重要组件。它是一个为分布式应用提供一致性服务的软件，提供的功能包括：配置维护、域名服务、分布式同步、组服务等。

#### Python Generator
[https://www.ibm.com/developerworks/cn/opensource/os-cn-python-yield/](https://www.ibm.com/developerworks/cn/opensource/os-cn-python-yield/)
- A generator is a function with a yield clause
- Local variables does not change when reach yield until the very end
- memory efficient

---
##### Python tips
[http://book.pythontips.com/en/latest/](http://book.pythontips.com/en/latest/)
- Python provides a better method for managing resources than destructors - contexts. It is better to use a context manager to release resources than using destructors.

##### Kafka
- Each broker holds a number of partitions and each of these partitions can be either a leader or a replica for a topic. All writes and reads to a topic go through the leader and the leader coordinates updating replicas with new data. If a leader fails, a replica takes over as the new leader.
- Producers write to a single leader, this provides a means of load balancing production so that each write can be serviced by a separate broker and machine. In the first image, the producer is writing to partition 0 of the topic and partition 0 replicates that write to the available replicas

![partition-write](/assets/images/producing-to-partitions.png)  
![consumergroup](/assets/images/consumer-groups.png)

- Consumer side consitency
  - make message processing and commit action transactional, all success or all fail, thought it is hard.
  - At most once, commit before process the message
  - At least once, commit after process the message
  
